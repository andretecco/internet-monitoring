---
#name: ansible-lint
#on: 
#  push:
#    branches:
#      - '*'
#      - '!main'
#
#  pull_request:
#    branches:
#      - '*'
#      - '!main'
#jobs:
#  build_ansible_lint:
#    name: Ansible Lint
#    runs-on: ubuntu-latest
#    outputs:
#      output: ${{ steps.step_lint.outputs.test }}
#    steps:
#      - uses: actions/checkout@v4
#      - name: Run ansible-lint
#        uses: ansible/ansible-lint@v6
#        id: step_lint
#
#  output_ansible_lint:
#    runs-on: ubuntu-latest
#    if: ${{ always() }}
#    needs: build_ansible_lint
#    steps:
#      - env:
#          OUTPUT1: ${{needs.build_ansible_lint.outputs.output}}
#        run: echo "$OUTPUT1"
#
#  discord_message:
#    name: Discord Message
#    runs-on: ubuntu-latest
#    if: ${{ always() }}
#    needs: build_ansible_lint
#    steps:
#      - name: Checkout
#        uses: actions/checkout@v3
#
#      - name: Success
#        uses: rjstone/discord-webhook-notify@v1
#        if: success()
#        with:
#            severity: info
#            details: Succeeded!
#            webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
#        
#      - name: Failure
#        uses: rjstone/discord-webhook-notify@v1
#        if: failure()
#        with:
#            severity: error
#            details: Failed!
#            webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
#        
#      - name: Cancelled
#        uses: rjstone/discord-webhook-notify@v1
#        if: cancelled()
#        with:
#            severity: warn
#            details: Cancelled!
#            webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}

name: ansible-lint
on: 
  push:
    branches:
      - '*'
      - '!main'
  pull_request:
    branches:
      - '*'
      - '!main'
jobs:
  build_ansible_lint:
    name: Ansible Lint
    runs-on: ubuntu-latest
    outputs:
      output: ${{ steps.ansible-lint-execute.outputs.output }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Instalando dependencias
        id: ansible-lint-install
        run: |
          python3 -m pip install --upgrade pip
          python3 -m pip install ansible-lint
      - name: Executando Lint
        id: ansible-lint-execute
        run: |
          ansible-lint >> "$GITHUB_OUTPUT"
      - name: Persistir Artefatos
        if: ${{ always() }}
        uses: actions/upload-artifact@v2
        with:
          name: ansible-lint-results
          path: ${{ steps.ansible-lint-execute.outputs.output }}

  ansible_lint_output:
    runs-on: ubuntu-latest
    if: ${{ always() }}
    needs: build_ansible_lint
    steps:
      - name: Baixar Artefatos
        uses: actions/download-artifact@v2
        with:
          name: ansible-lint-results
          path: ${{ steps.ansible-lint-execute.outputs.output }}
      - name: Exibir Sa√≠da
        run: |
          value=`cat ${{ steps.ansible-lint-execute.outputs.output }}`
          echo $value

  discord_message:
    name: Discord Message
    runs-on: ubuntu-latest
    if: ${{ always() }}
    needs: build_ansible_lint
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Success
        uses: rjstone/discord-webhook-notify@v1
        if: success()
        with:
            severity: info
            details: Succeeded!
            webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
        
      - name: Failure
        uses: rjstone/discord-webhook-notify@v1
        if: failure()
        with:
            severity: error
            details: Failed!
            webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
        
      - name: Cancelled
        uses: rjstone/discord-webhook-notify@v1
        if: cancelled()
        with:
            severity: warn
            details: Cancelled!
            webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}